<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Propose penalty basis dimension from the number of distinct dates — penalty_dim_heuristic • RtGam</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Propose penalty basis dimension from the number of distinct dates — penalty_dim_heuristic"><meta name="description" content="Return a reasonable value for the m argument of RtGam() based on the
number of dates that cases are observed. The m argument controls the
dimension of the smoothing penalty basis for the model's global smooth trend
(see the Model specification section of the RtGam() documentation for
more information about the global trend). The penalty basis dimension
controls how much the wiggliness of the global smooth trend can vary over
time. Higher values of m help the model to adapt quickly to different
epidemic regimes, but are computationally costly."><meta property="og:description" content="Return a reasonable value for the m argument of RtGam() based on the
number of dates that cases are observed. The m argument controls the
dimension of the smoothing penalty basis for the model's global smooth trend
(see the Model specification section of the RtGam() documentation for
more information about the global trend). The penalty basis dimension
controls how much the wiggliness of the global smooth trend can vary over
time. Higher values of m help the model to adapt quickly to different
epidemic regimes, but are computationally costly."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RtGam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/RtGam.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cdcgov/cfa-gam-rt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Propose penalty basis dimension from the number of distinct dates</h1>
      <small class="dont-index">Source: <a href="https://github.com/cdcgov/cfa-gam-rt/blob/main/R/RtGam.R" class="external-link"><code>R/RtGam.R</code></a></small>
      <div class="d-none name"><code>penalty_dim_heuristic.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Return a reasonable value for the <code>m</code> argument of <code><a href="RtGam.html">RtGam()</a></code> based on the
number of dates that cases are observed. The <code>m</code> argument controls the
dimension of the smoothing penalty basis for the model's global smooth trend
(see the <em>Model specification</em> section of the <code><a href="RtGam.html">RtGam()</a></code> documentation for
more information about the global trend). The penalty basis dimension
controls how much the wiggliness of the global smooth trend can vary over
time. Higher values of <code>m</code> help the model to adapt quickly to different
epidemic regimes, but are computationally costly.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">penalty_dim_heuristic</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>An integer, the number of dates with an associated case observation.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An integer, the proposed penalty basis dimension to be used by the
global trend.</p>
    </div>
    <div class="section level2">
    <h2 id="how-m-is-used">How <code>m</code> is used<a class="anchor" aria-label="anchor" href="#how-m-is-used"></a></h2>
    <p>The parameter <code>m</code> controls the penalty basis dimension of the model's global
smooth trend. If <code>m</code> is 1, there will be single constant penalty on
wiggliness over the entire smooth and <a href="RtGam.html">RtGam</a> will use a thin-plate spline
basis for its superior performance in single-penalty settings. If <code>m</code> is 2 or
more, the model will use <code>m</code> distinct penalties on the smooth trend's
wiggliness and use an adaptive spline basis. The realized penalty at each
timepoint smoothly interpolates between the <code>m</code> estimated wiggliness
penalties. This adaptive penalty increases the computational cost of the
model, but allows for a single model to adapt to changing epidemic dynamics
without oversmoothing or introducing spurious wiggly trends.</p>
    </div>
    <div class="section level2">
    <h2 id="when-to-use-a-different-value">When to use a different value<a class="anchor" aria-label="anchor" href="#when-to-use-a-different-value"></a></h2>

<div class="section">
<h3 id="very-slow">Very slow<a class="anchor" aria-label="anchor" href="#very-slow"></a></h3>


<p>Decreasing the penalty basis dimension makes the model less demanding to fit.
<code>mgcv</code> describes an adaptive penalty with 10 basis dimensions and 200 data
points as roughly equivalent to fitting 10 GAMs each from 20 data points.
Using a single penalty throughout the model is much simpler than using an
adaptive smooth and should be preferred where possible. See
<code>[mgcv::smooth.construct.ad.smooth.spec]</code> for more information on how the
adaptive smooth basis uses the penalty dimension.</p>
</div>

<div class="section">
<h3 id="observed-over-smoothing-of-non-stationary-data">Observed over-smoothing of non-stationary data<a class="anchor" aria-label="anchor" href="#observed-over-smoothing-of-non-stationary-data"></a></h3>


<p>If a fitted model is observably over-smoothing, it may be reasonable to refit
with a higher penalty basis dimension. Moments with a sudden change in
epidemic dynamics, such as a sharp epidemic peak, can be challenging to fit
with smooth functions. This option should be used with care due to the
increased computational cost.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="implementation-details">Implementation details<a class="anchor" aria-label="anchor" href="#implementation-details"></a></h2>
    <p>The algorithm to pick <code>m</code> is \(\lfloor \frac{n}{21} \rfloor + 1\) where
\(n \in \mathbb{W}\) is the number of observed dates. This algorithm
assumes that over a 21-day period, epidemic dynamics remain roughly similarly
wiggly. Sharp jumps or drops requiring a very wiggly trend would remain
similarly plausible over much of the 21-day band.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="RtGam.html">RtGam()</a></code> for the use-case and additional documentation as well as
<a href="https://rdrr.io/pkg/mgcv/man/smooth.construct.ad.smooth.spec.html" class="external-link">mgcv::smooth.construct.ad.smooth.spec</a> for an explanation of the
underlying adaptive-smooth machinery.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Default use invokes `unique()` in case of repeated dates from groups</span></span></span>
<span class="r-in"><span><span class="va">reference_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-01-01"</span>, <span class="st">"2023-01-02"</span>, <span class="st">"2023-01-03"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">penalty_dim_heuristic</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">reference_date</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachary Susswein, Katelyn Gostic, Sam Abbott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

