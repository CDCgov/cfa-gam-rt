<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Parameter-specific posterior predictions — predictor • RtGam</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Parameter-specific posterior predictions — predictor"><meta name="description" content="Generate posterior draws from an RtGam fit. Prediction dates can be
specified flexibly using various approaches, and predictions can be drawn for
different model parameters."><meta property="og:description" content="Generate posterior draws from an RtGam fit. Prediction dates can be
specified flexibly using various approaches, and predictions can be drawn for
different model parameters."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RtGam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.1000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/RtGam.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cdcgov/cfa-gam-rt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Parameter-specific posterior predictions</h1>
      <small class="dont-index">Source: <a href="https://github.com/cdcgov/cfa-gam-rt/blob/main/R/predict.R" class="external-link"><code>R/predict.R</code></a></small>
      <div class="d-none name"><code>predictor.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generate posterior draws from an <code>RtGam</code> fit. Prediction dates can be
specified flexibly using various approaches, and predictions can be drawn for
different model parameters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">predict_obs_cases</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  day_of_week <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  gi_pmf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  call <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">caller_env</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">predict_growth_rate</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  gi_pmf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  <span class="va">mean_delay</span>,</span>
<span>  call <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">caller_env</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">predict_rt</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  gi_pmf <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  <span class="va">mean_delay</span>,</span>
<span>  call <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html" class="external-link">caller_env</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An <code>RtGam</code> object created using the <code><a href="RtGam.html">RtGam()</a></code>
function.</p></dd>


<dt id="arg-horizon">horizon<a class="anchor" aria-label="anchor" href="#arg-horizon"></a></dt>
<dd><p>Optional. An integer indicating the number of days to
forecast beyond the last date in the model fit. For example, <code>horizon = 7</code>
predicts the next 7 days.</p></dd>


<dt id="arg-min-date-max-date">min_date, max_date<a class="anchor" aria-label="anchor" href="#arg-min-date-max-date"></a></dt>
<dd><p>Optional. Date-like objects specifying the start
and end of the prediction range. See <strong>Details</strong> for more information on
their usage.</p></dd>


<dt id="arg-day-of-week">day_of_week<a class="anchor" aria-label="anchor" href="#arg-day-of-week"></a></dt>
<dd><p>How to handle day-of-week effects when predicting
<code>obs_cases</code>. Defaults to <code>TRUE</code>, which identifies and applies the fitted
day-of-week effect, if possible. When automatic detection fails or
different levels are desirable, custom levels can be applied with a vector
of equal length to the number of desired dates. If <code>FALSE</code>, the day-of-week
effect is turned off (i.e., set to zero). When predicting parameters other
than <code>obs_cases</code> or <code>object</code> is an <code>RtGam</code> model that did not include
day-of-week effects, the day-of-week effect is turned off and this argument
is silently ignored.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>An integer specifying the number of posterior samples to use
for predictions. Default is 100.</p></dd>


<dt id="arg-gi-pmf">gi_pmf<a class="anchor" aria-label="anchor" href="#arg-gi-pmf"></a></dt>
<dd><p>Optional. A numeric vector specifying the generation interval
probability mass function (PMF), required when <code>parameter = "Rt"</code>. The PMF
must be a proper probability distribution (summing to one) with the first
element set to zero to exclude same-day transmission, as required by the
renewal equation. For more information and tools to handle delay
distributions, see the
<a href="https://CRAN.R-project.org/package=primarycensored" class="external-link">primarycensored</a>
package.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An integer specifying the random seed for reproducibility.
Default is 12345.</p></dd>


<dt id="arg-call">call<a class="anchor" aria-label="anchor" href="#arg-call"></a></dt>
<dd><p>The calling environment to pass to error messages</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to the underlying sampling functions:</p><ul><li><p>When <code>parameter = "obs_cases"</code>, arguments are passed to <code>gratia: posterior_samples</code>.</p></li>
<li><p>When <code>parameter = "r"</code> or <code>"Rt"</code>, arguments are passed to <code>gratia: fitted_samples</code>.</p></li>
</ul></dd>


<dt id="arg-mean-delay">mean_delay<a class="anchor" aria-label="anchor" href="#arg-mean-delay"></a></dt>
<dd><p>Optional. An integer specifying the mean number of days
between an individual becoming infected and their case being observed
(e.g., through an emergency department visit or hospitalization). This
value shifts the predictions to account for reporting delays. It is
required when predicting <code>"r"</code> (growth rate) or <code>"Rt"</code> (reproduction
number).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame in
<a href="https://www.jstatsoft.org/article/view/v059i10" class="external-link">tidy format</a>,
where each row represents a posterior draw for a specific date, with the
following columns:</p><ul><li><p><code>reference_date</code>: The prediction date.</p></li>
<li><p><code>.response</code>: The predicted value for the target parameter.</p></li>
<li><p><code>.draw</code>: The index of the posterior draw.</p></li>
</ul><p>Example output:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>  reference_date .response .draw</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">2023-01-01</span>        <span class="dv">18</span>     <span class="dv">1</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="dv">2</span>     <span class="dv">2023-01-02</span>        <span class="dv">13</span>     <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">2023-01-03</span>        <span class="dv">21</span>     <span class="dv">1</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="dv">4</span>     <span class="dv">2023-01-01</span>        <span class="dv">11</span>     <span class="dv">2</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="dv">5</span>     <span class="dv">2023-01-02</span>        <span class="dv">19</span>     <span class="dv">2</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="dv">6</span>     <span class="dv">2023-01-03</span>        <span class="dv">24</span>     <span class="dv">2</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Prediction dates can be defined in four ways:</p><ol><li><p><strong>Default Date Range</strong>: By using only the fit object, predictions are made
across the full date range in the original model.</p></li>
<li><p><strong>Using <code>horizon</code></strong>: Extends predictions up to <code>horizon</code> days beyond the
last date in the model fit.</p></li>
<li><p><strong>Using <code>min_date</code> and <code>horizon</code></strong>: Predictions start from <code>min_date</code> and
extend up to <code>horizon</code> days after the fit’s last date.</p></li>
<li><p><strong>Using <code>min_date</code> and <code>max_date</code></strong>: Generates predictions for all dates
within this specified range, inclusive.</p></li>
</ol><p>The <code>mean_delay</code> parameter adjusts predictions for the
temporal lag between infection and case observation. For example, if
<code>mean_delay = 5</code>,
the model assumes that observed cases reflect infections that occurred on
average five days
earlier. This adjustment ensures that estimates of growth rates (<code>"r"</code>) and
reproduction
numbers (<code>"Rt"</code>) align with the correct underlying temporal dynamics.</p>
<p>The <code>parameter</code> argument determines the type of predictions:</p><ul><li><p><code>"obs_cases"</code>: Observed cases, including uncertainty from the model's
fit.</p></li>
<li><p><code>"r"</code>: Growth rate, calculated using the centered difference between time
steps.</p></li>
<li><p><code>"Rt"</code>: Reproduction number, incorporating delay distributions and
convolution.</p></li>
</ul><p>Samples are drawn from the posterior distribution of the fitted model using
the <code>gratia</code> package. The model estimates basis function coefficients on the
smooth terms \(\widehat{\beta}\) and smoothing parameter(s) \(\lambda\). The
coefficients have the approximate joint posterior distribution
$$\beta | \lambda \sim N(\widehat{\beta}, \mathbf{V}_{\widehat{\beta}})$$
where \(\mathbf{V}_{\widehat{\beta}}\) is the smoothing-parameter uncertainty
corrected covariance matrix of the basis function coefficients. We draw
samples from this approximate posterior and multiply them by the dates of
interest to generate posterior draws. If estimating <code>"Rt"</code> or <code>"r"</code>
the day-of-week effect is excluded (i.e., set to zero). Further processing
of these draws to generate parameters of interest is described below.</p>
<p>For the intrinsic growth rate, we draw one day before and one day after every
day of interest. We difference these two days within the smooth to get growth
in the period and divide by two to generate the discrete centered derivative.</p>
<p>For the Rt we map the estimated values on the linear predictor scale back to
the response scale and shift the estimated cases by the mean delay to get
the estimated incident infections (\(I\)). We use the incident infections
and the generation interval probability mass function (\(w\)) to estimate
Rt via the Cori method: \(I_t / \sum_{s = 1}^{t} I_{t - s} w_s\)</p>
<p>For observed incident cases, we apply the estimated negative binomial
observation error to the posterior expected incident cases to generate
posterior predicted incident cases.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Miller, David L. "Bayesian views of generalized additive
modelling." arXiv preprint arXiv:1902.01330 (2021). <br><br>
Gostic, Katelyn M., et al. "Practical considerations for measuring the
effective reproductive number, Rt." PLoS computational biology 16.12
(2020): e1008409. <br><br>
Simpson, Gavin L. "Gratia: An R package for exploring generalized additive
models." arXiv preprint arXiv:2406.19082 (2024). <br><br>
Cori A, Ferguson NM, Fraser C, Cauchemez S. A New Framework and Software to
Estimate Time-Varying Reproduction Numbers During Epidemics. Am J Epidemiol.
2013;178(9):1505–12. pmid:24043437 <br><br>
Wood, Simon N. Generalized additive models: an introduction with R. chapman
and hall/CRC, 2017.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://gavinsimpson.github.io/gratia/reference/fitted_samples.html" class="external-link">gratia::fitted_samples()</a></code>, <code><a href="https://gavinsimpson.github.io/gratia/reference/posterior_samples.html" class="external-link">gratia::posterior_samples()</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachary Susswein, Katelyn Gostic, Sam Abbott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

