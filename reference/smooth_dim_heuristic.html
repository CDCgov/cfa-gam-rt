<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Propose total smoothing basis dimension from the number of data points — smooth_dim_heuristic • RtGam</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Propose total smoothing basis dimension from the number of data points — smooth_dim_heuristic"><meta name="description" content="Return a reasonable value for the k argument of RtGam (the total smooth
basis dimension of the model's one or more smooth predictors) based on the
number of data points. The smooth basis dimension controls the maximum
degrees of freedom (and by proxy the &quot;wiggliness&quot;) of the smooth predictors.
The estimation procedure leans toward providing an excess number of degrees
of freedom to the model. The consequence is slower model fits, but a better
chance of avoiding avoiding non-convergence due to undersmoothing. If
manually supplying a value to k rather than relying on the default
estimate, see When to use a different value for RtGam-specific
implementation guidance and mgcv::choose.k for more general debugging
guidance from the underlying model fitting package. Note that k may be a
minimum of 2 or a maximum of the number of data points."><meta property="og:description" content="Return a reasonable value for the k argument of RtGam (the total smooth
basis dimension of the model's one or more smooth predictors) based on the
number of data points. The smooth basis dimension controls the maximum
degrees of freedom (and by proxy the &quot;wiggliness&quot;) of the smooth predictors.
The estimation procedure leans toward providing an excess number of degrees
of freedom to the model. The consequence is slower model fits, but a better
chance of avoiding avoiding non-convergence due to undersmoothing. If
manually supplying a value to k rather than relying on the default
estimate, see When to use a different value for RtGam-specific
implementation guidance and mgcv::choose.k for more general debugging
guidance from the underlying model fitting package. Note that k may be a
minimum of 2 or a maximum of the number of data points."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RtGam</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cdcgov/cfa-gam-rt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Propose total smoothing basis dimension from the number of data points</h1>
      <small class="dont-index">Source: <a href="https://github.com/cdcgov/cfa-gam-rt/blob/main/R/RtGam.R" class="external-link"><code>R/RtGam.R</code></a></small>
      <div class="d-none name"><code>smooth_dim_heuristic.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Return a reasonable value for the <code>k</code> argument of <a href="RtGam.html">RtGam</a> (the <em>total</em> smooth
basis dimension of the model's one or more smooth predictors) based on the
number of data points. The smooth basis dimension controls the maximum
degrees of freedom (and by proxy the "wiggliness") of the smooth predictors.
The estimation procedure leans toward providing an excess number of degrees
of freedom to the model. The consequence is slower model fits, but a better
chance of avoiding avoiding non-convergence due to undersmoothing. If
manually supplying a value to <code>k</code> rather than relying on the default
estimate, see <em>When to use a different value</em> for <a href="RtGam.html">RtGam</a>-specific
implementation guidance and <a href="https://rdrr.io/pkg/mgcv/man/choose.k.html" class="external-link">mgcv::choose.k</a> for more general debugging
guidance from the underlying model fitting package. Note that <code>k</code> may be a
minimum of 2 or a maximum of the number of data points.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">smooth_dim_heuristic</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>An integer, the dimension of the data.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An integer, the proposed <em>total</em> smooth basis dimensionality
available to the <a href="RtGam.html">RtGam</a> model.</p>
    </div>
    <div class="section level2">
    <h2 id="how-k-is-used">How <code>k</code> is used<a class="anchor" aria-label="anchor" href="#how-k-is-used"></a></h2>
    <p>The model is composed of one or more smooth predictors, depending the
specifics of the model specification. In a simple model with only one smooth
predictor, all the degrees of freedom from <code>k</code> would be applied to that
single smooth. In a more complex model composed of multiple smooth
predictors, the total degrees degrees of freedom made available by <code>k</code> would
be partitioned between the different smooths.</p>
    </div>
    <div class="section level2">
    <h2 id="when-to-use-a-different-value">When to use a different value<a class="anchor" aria-label="anchor" href="#when-to-use-a-different-value"></a></h2>

<div class="section">
<h3 id="model-non-convergence">Model non-convergence<a class="anchor" aria-label="anchor" href="#model-non-convergence"></a></h3>


<p>When an <a href="RtGam.html">RtGam</a> model does not converge, a reasonable first debugging step is
to increase the value of <code>k</code> and refit the model. Commonly, GAMs exhibit
diagnostic issues when the model does not have enough flexibility to
represent the underlying data generating process. Increasing <code>k</code> above the
default estimate provides more flexibility.</p>
<p>However, insufficient flexibility is not the only source of non-convergence.
When increasing <code>k</code> does not improve the default model diagnostics, manual
model checking via <code><a href="https://rdrr.io/pkg/mgcv/man/gam.check.html" class="external-link">mgcv::gam.check()</a></code> may be needed. Also see
<a href="https://rdrr.io/pkg/mgcv/man/choose.k.html" class="external-link">mgcv::choose.k</a> for guidance.</p>
</div>

<div class="section">
<h3 id="slow-model-fits">Slow model fits<a class="anchor" aria-label="anchor" href="#slow-model-fits"></a></h3>


<p><a href="RtGam.html">RtGam</a> models usually fit faster when the model has less flexibility (lower
values of <code>k</code>). The guess from <code>smooth_dim_heuristic()</code> leans toward
providing excess degrees of freedom, so model fits may take a little longer
than needed. If models are taking a long time to converge, it would be
reasonable to set <code>k</code> to a small value, checking for convergence, and
increasing <code>k</code> if needed until the model convergences. This approach may or
may not be faster than simply waiting for a model with a higher <code>k</code> to fit.</p>
</div>

<div class="section">
<h3 id="very-wiggly-data">Very wiggly data<a class="anchor" aria-label="anchor" href="#very-wiggly-data"></a></h3>


<p>If running models in a setting where the data seem quite wiggly, exhibiting
sharp jumps or drops, a model with more flexibility than normal may be
needed. <code>k</code> should be increased to the maximum possible value. When running
pre-set models in production, it would also be reasonable to fix the value of
<code>k</code> above the default. Because GAMs penalize model wiggliness, the fit to
both wiggly and non-wiggly data is likely to be satisfactory, at the cost of
increased runtime.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="implementation-details">Implementation details<a class="anchor" aria-label="anchor" href="#implementation-details"></a></h2>
    <p>The algorithm to pick <code>k</code> is a piecewise function. When \(n \le 10\), then
the returned value is \(n\). When \(n &gt; 10\), then the returned value is
\( \lceil \sqrt{10n} \rceil \). This approach is loosely inspired by Ward
et al., 2021. As in Ward et al. the degrees of freedom of the spline (1) is
set to a reasonably high value to avoid oversmoothing and (2) scales with the
dimension of the data to accommodate changing trends over time.</p>
<p><code>smooth_dim_heuristic()</code> uses a piecewise function because each smooth
parameter needs its own degrees of freedom, which adds a fixed initial setup
cost. When the dimension of the data is small, the default value of <code>k</code>
increases linearly with the data to accommodate this fixed setup cost. When
the dimension of the data is larger, the default value of <code>k</code> increases with
the square root of the data to balance having sufficient basis dimension to
fit to changing trends over time without having so many dimensions that model
fits are very slow.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Ward, Thomas, et al. "Growth, reproduction numbers and factors
affecting the spread of SARS-CoV-2 novel variants of concern in the UK from
October 2020 to July 2021: a modeling analysis." BMJ open 11.11 (2021):
e056636.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="RtGam.html">RtGam()</a></code> for the use-case and additional documentation as well as
<a href="https://rdrr.io/pkg/mgcv/man/choose.k.html" class="external-link">mgcv::choose.k</a> and <a href="https://rdrr.io/pkg/mgcv/man/gam.check.html" class="external-link">mgcv::gam.check</a> for more general guidance from
<code>mgcv</code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu">smooth_dim_heuristic</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachary Susswein, Katelyn Gostic, Sam Abbott.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

